<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>รายการคำสั่งซื้อ - แผนกปลา</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
    }
    .order-card {
      background-color: #1f1f1f;
      border-left: 5px solid #0d6efd;
    }
  </style>
</head>
<body class="p-5">
  <h2 class="mb-4">รายการคำสั่งซื้อ - แผนกปลา</h2>
  <div id="order-list"></div>

  <script>
    let latestQueue = null;

    async function loadOrders() {
      try {
        const res = await fetch('/api/orders/fish');
        const orders = await res.json();

        if (orders.length > 0 && orders[orders.length - 1].queue === latestQueue) return;
        latestQueue = orders[orders.length - 1]?.queue;

        const list = document.getElementById("order-list");
        list.innerHTML = ""; // clear ของเดิม

        orders.forEach((order, index) => {
          let statusBadge = "";
          let actionBtn = "";

          if (order.status === "new") {
            statusBadge = `<span class="badge bg-primary">New</span>`;
            actionBtn = `<a href="/update_status/${index}/in_process/fish" class="btn btn-sm btn-outline-light ms-2">รับรายการ</a>`;
          } else if (order.status === "in_process") {
            statusBadge = `<span class="badge bg-warning text-dark">In Process</span>`;
            actionBtn = `<a href="/update_status/${index}/done/fish" class="btn btn-sm btn-outline-light ms-2">ออเดอร์นี้เสร็จแล้ว</a>`;
          } else {
            statusBadge = `<span class="badge bg-success">Completed</span>`;
          }

          const html = `
            <div class="order-card p-3 mb-3 rounded shadow-sm">
              <h5>ลูกค้า: ${order.customer}</h5>
              <p><strong>รหัสสินค้า:</strong> ${order.item}</p>
              <p><strong>รายละเอียด:</strong> ${order.detail}</p>
              <p><strong>คิว:</strong> ${order.queue}</p>
              ${statusBadge} ${actionBtn}
            </div>
          `;
          list.innerHTML += html;
        });
      } catch (err) {
        console.error("โหลดข้อมูลล้มเหลว:", err);
      }
    }

    loadOrders();
    setInterval(loadOrders, 5000);
  </script>
</body>
</html>
