<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>รายการคำสั่งซื้อ - แผนกหมู</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
    }
    .order-card {
      background-color: #1f1f1f;
      border-left: 5px solid #0d6efd;
    }
  </style>
</head>
<body class="p-5">
  <h2 class="mb-4">รายการคำสั่งซื้อ - แผนกหมู</h2>
  <div id="order-list"></div>

<script>
  var latestQueue = null;

  function loadOrders() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '/api/orders/pork', true);

    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        var orders = JSON.parse(xhr.responseText);

        if (orders.length > 0 && orders[orders.length - 1].queue === latestQueue) return;
        latestQueue = orders[orders.length - 1] ? orders[orders.length - 1].queue : null;

        var list = document.getElementById("order-list");
        list.innerHTML = "";

        for (var i = 0; i < orders.length; i++) {
          var order = orders[i];
          var badge = "";
          var btn = "";

          if (order.status === "new") {
            badge = '<span class="badge bg-primary">New</span>';
            btn = '<a href="/update_status/' + i + '/in_process/pork" class="btn btn-sm btn-outline-light ms-2">รับรายการ</a>';
          } else if (order.status === "in_process") {
            badge = '<span class="badge bg-warning text-dark">In Process</span>';
            btn = '<a href="/update_status/' + i + '/done/pork" class="btn btn-sm btn-outline-light ms-2">ออเดอร์นี้เสร็จแล้ว</a>';
          } else {
            badge = '<span class="badge bg-success">Completed</span>';
          }

          var html = '<div class="order-card p-3 mb-3 rounded shadow-sm">' +
                     '<h5>ลูกค้า: ' + order.customer + '</h5>' +
                     '<p><strong>รหัสสินค้า:</strong> ' + order.item + '</p>' +
                     '<p><strong>รายละเอียด:</strong> ' + order.detail + '</p>' +
                     '<p><strong>คิว:</strong> ' + order.queue + '</p>' +
                     badge + ' ' + btn +
                     '</div>';

          list.innerHTML += html;
        }
      }
    };
    xhr.send();
  }

  loadOrders();
  setInterval(loadOrders, 5000);
</script>
</body>
</html>
